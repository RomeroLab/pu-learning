---
title: "pudms"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{pudms}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Examples

### Model fitting with a full data set

Here we demonstrate basic usage of the package using sample labeled and unlabeled sequences (10,000 randomly sampled sequences from casp3 protein data sets)

Input:
- path_l, path_u 
- WT (reference sequence)
- py1 = 0.2

Here we use the paths where the sample txt files are saved. Please replace them with the actual file paths (e.g. `"system.file("extdata", "sample_positive_mutations.txt", package = "pudms",mustWork = T)"` -> `"your dir/filename.txt"`)

```{r}
library(pudms)
# recover paths
path_l = system.file("extdata", "sample_positive_mutations.txt", 
                     package = "pudms",mustWork = T)
path_u = system.file("extdata", "sample_unlabeled_mutations.txt", 
                     package = "pudms",mustWork = T)

# WT (reference) sequence
WT = 'MSGISLDNSYKMDYPEMGLCIIINNKNFHKSTGMTSRSGTDVDAANLRETFRNLKYEVRNKNDLTREEIVELMRDVSKEDHSKRSSFVCVLLSHGEEGIIFGTNGPVDLKKITNFFRGDRCRSLTGKPKLFIIQACRGTELDCGIETDSGVDDDMACHKIPVEADFLYAYSTAPGYYSWRNSKDGSWFIQSLCAMLKQYADKLEFMHILTRVNRKVATEFESFSFDATFHAKKQIPCIVSMLTKELYFYHLEHHHHHH*'
```

1. We generate a protein dataset from the specified paths.

```{r}
smpl_dat = create_protein_dat(path_l = path_l, path_u = path_u, WT = WT)
```

2. Now, we fit a model

```{r}
# we filter sequences containing mutations with total number < nobs_thresh
fit1 = pudms(protein_dat = smpl_dat,py1 = 0.2,nobs_thresh = 10) 
```

3. Done!

To view the result in R:
```{r,eval=F}
View(fit1$result_table)
```

To extract the result into the excel file:
```{r,eval=F}
require(xlsx)
write.xlsx(x = fit1$result_table, sheetName = "result", file = "your path/result_table.xlsx")
```


### Model fitting with x\% of the data (training set) and obtaining ROC curve with remaining (100-x)\% of the data

Here we use $x = 90$ (90\% for training, 10\% for test)

1. We split previously generated `smpl_dat` into 90/10 subsamples

```{r}
cv_smpl = cv_grouped_dat(grouped_dat = smpl_dat,
                         test_idx = 1,
                         nfolds = 10,
                         seed = 1)

tr_smpl = cv_smpl$train_grouped_dat # training set
tt_smpl = cv_smpl$test_grouped_dat # test set
```

2. We fit a model using a training set `tr_smpl`

```{r}
cv.r = pudms(protein_dat = tr_smpl,py1 = 0.2,nobs_thresh = 10)
```

3. We obtain a PU-corrected ROC curve using a test set `tt_smpl`
```{r,fig.height=6,fig.width=6}
roc = corrected_roc_curve(coef = coef(cv.r), test_grouped_dat = tt_smpl,py1 = 0.2)
roc$rocplot
```
